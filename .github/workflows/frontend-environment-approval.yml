name: Frontend Environment Approval

on:
  push:
    branches: [develop]
    paths: ['web/**']

jobs:
  deploy-staging:
    runs-on: ubuntu-latest
    environment: staging
    outputs:
      preview-url: ${{ steps.deploy.outputs.preview-url }}
    steps:
      - uses: actions/checkout@v4
      
      - name: Deploy to Staging
        id: deploy
        uses: amondnet/vercel-action@v25.2.0
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          scope: ${{ secrets.VERCEL_ORG_ID }}
      
      - name: Comment with Instructions
        uses: actions/github-script@v7
        with:
          script: |
            const message = `## ðŸš€ Staging Deployment Ready!
            
            **Preview URL:** ${{ steps.deploy.outputs.preview-url }}
            
            ### ðŸ“· Screenshot Requirements:
            Before approving production deployment, please:
            
            1. **Test the preview URL thoroughly**
            2. **Take screenshots** of:
               - Desktop view (key pages)
               - Mobile view (responsive design) 
               - Any new features in action
               - Error states and edge cases
            3. **Upload screenshots** to the production approval request
            4. **Comment with approval** when satisfied
            
            The production deployment is now waiting for your approval in the Actions tab.
            `;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: message
            });

  deploy-production:
    needs: deploy-staging
    runs-on: ubuntu-latest
    environment: production  # This will require manual approval in GitHub
    steps:
      - uses: actions/checkout@v4
      
      - name: Deploy to Production
        uses: amondnet/vercel-action@v25.2.0
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'
          scope: ${{ secrets.VERCEL_ORG_ID }} 